<div class="mx-auto max-w-3xl p-4">
  <h1 class="text-2xl font-semibold">Ejercicio 4: Lista de tareas (CRUD en memoria)</h1>
  <p class="mt-2 text-neutral-700">Crea, edita, elimina y marca tareas como completadas.</p>

  <form class="mt-4 flex gap-2" (ngSubmit)="agregar()">
    <input type="text" [(ngModel)]="nuevoTitulo" name="nuevoTitulo" placeholder="Nueva tarea"
           class="flex-1 px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-neutral-300" />
    <button type="submit" class="cursor-pointer px-3 py-2 rounded-md bg-black text-white hover:bg-gray-800 transition-colors duration-200">Agregar</button>
    <button type="button" (click)="limpiarCompletadas()" class="cursor-pointer px-3 py-2 rounded-md bg-neutral-200 hover:bg-neutral-300 transition-colors duration-200">Limpiar completadas</button>
  </form>

  <ul class="mt-4 space-y-2">
    <li *ngFor="let t of (tareas$ | async)" class="p-3 border rounded-md flex items-center gap-3">
      <input type="checkbox" [checked]="t.completada" (change)="toggleCompletada(t.id)" class="h-4 w-4" />

      <ng-container *ngIf="editandoId !== t.id; else editTpl">
        <span class="flex-1" [class.line-through]="t.completada">{{ t.titulo }}</span>
        <div class="flex gap-2">
          <button class="cursor-pointer px-3 py-1.5 rounded-md bg-neutral-800 text-white hover:bg-neutral-700 transition-colors duration-200" (click)="iniciarEdicion(t)">Editar</button>
          <button class="cursor-pointer px-3 py-1.5 rounded-md bg-neutral-200 hover:bg-neutral-300 transition-colors duration-200" (click)="eliminar(t.id)">Eliminar</button>
        </div>
      </ng-container>

      <ng-template #editTpl>
        <input type="text" [(ngModel)]="editandoTitulo" name="editTitulo-{{t.id}}" class="flex-1 px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-neutral-300" />
        <div class="flex gap-2">
          <button class="cursor-pointer px-3 py-1.5 rounded-md bg-black text-white hover:bg-gray-800 transition-colors duration-200" (click)="guardarEdicion()">Guardar</button>
          <button class="cursor-pointer px-3 py-1.5 rounded-md bg-neutral-200 hover:bg-neutral-300 transition-colors duration-200" (click)="cancelarEdicion()">Cancelar</button>
        </div>
      </ng-template>
    </li>
  </ul>
  <app-next />
</div>
